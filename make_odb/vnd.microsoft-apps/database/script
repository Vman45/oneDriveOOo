SET DATABASE COLLATION "French"
CREATE SCHEMA PUBLIC AUTHORIZATION DBA
CREATE TEXT TABLE "Settings"("Setting" VARCHAR(100) NOT NULL PRIMARY KEY,"Set1" VARCHAR(100) NOT NULL,"Set2" VARCHAR(100) NOT NULL,"Set3" VARCHAR(100) NOT NULL)
SET TABLE "Settings" SOURCE "vnd.microsoft-apps.csv"
SET TABLE "Settings" READONLY TRUE
CREATE CACHED TABLE "Users"("UserId" VARCHAR(100) NOT NULL,"UserName" VARCHAR(100) NOT NULL,"DisplayName" VARCHAR(100),"RootId" VARCHAR(100) NOT NULL,"TimeStamp" TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,PRIMARY KEY("UserId"),CONSTRAINT "UniqueUserName" UNIQUE("UserName"))
CREATE CACHED TABLE "Items"("ItemId" VARCHAR(100) NOT NULL,"Title" VARCHAR(100),"DateCreated" TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,"DateModified" TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,"MediaType" VARCHAR(100) DEFAULT 'application/octet-stream' NOT NULL,"Size" BIGINT DEFAULT 0 NOT NULL,"Trashed" BOOLEAN DEFAULT FALSE NOT NULL,"Loaded" SMALLINT DEFAULT 0 NOT NULL,"TimeStamp" TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,PRIMARY KEY("ItemId"))
CREATE CACHED TABLE "Parents"("UserId" VARCHAR(100) NOT NULL,"ItemId" VARCHAR(100) NOT NULL,"ChildId" VARCHAR(100) NOT NULL,"TimeStamp" TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,PRIMARY KEY("UserId","ItemId","ChildId"),CONSTRAINT "ForeignParentUsers" FOREIGN KEY("UserId") REFERENCES "Users"("UserId") ON DELETE CASCADE ON UPDATE CASCADE,CONSTRAINT "ForeignParentItems" FOREIGN KEY("ItemId") REFERENCES "Items"("ItemId") ON DELETE CASCADE ON UPDATE CASCADE,CONSTRAINT "ForeignChildItems" FOREIGN KEY("ChildId") REFERENCES "Items"("ItemId")  ON DELETE CASCADE ON UPDATE CASCADE)
CREATE CACHED TABLE "Capabilities"("UserId" VARCHAR(100) NOT NULL,"ItemId" VARCHAR(100) NOT NULL,"CanAddChild" BOOLEAN DEFAULT TRUE NOT NULL,"CanRename" BOOLEAN DEFAULT TRUE NOT NULL,"IsReadOnly" BOOLEAN DEFAULT FALSE NOT NULL,"IsVersionable" BOOLEAN DEFAULT FALSE NOT NULL,"SyncMode" SMALLINT DEFAULT 0 NOT NULL,"TimeStamp" TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,PRIMARY KEY("UserId","ItemId"),CONSTRAINT "ForeignCapabilitiesUsers" FOREIGN KEY("UserId") REFERENCES "Users"("UserId") ON DELETE CASCADE ON UPDATE CASCADE,CONSTRAINT "ForeignCapabilitiesItems" FOREIGN KEY("ItemId") REFERENCES "Items"("ItemId") ON DELETE CASCADE ON UPDATE CASCADE)
CREATE CACHED TABLE "Identifiers"("Id" VARCHAR(100) NOT NULL,"UserId" VARCHAR(100) NOT NULL,"TimeStamp" TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,PRIMARY KEY("Id"),CONSTRAINT "ForeignIdentifiersUsers" FOREIGN KEY("UserId") REFERENCES PUBLIC."Users"("UserId") ON DELETE CASCADE ON UPDATE CASCADE)
CREATE CACHED TABLE "Synchronizes"("SyncId" BIGINT GENERATED BY DEFAULT AS IDENTITY,"UserId" VARCHAR(100) NOT NULL,"ItemId" VARCHAR(100) NOT NULL,"SyncMode" SMALLINT DEFAULT 0 NOT NULL,"TimeStamp" TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,CONSTRAINT "ForeignSynchronizesUsers" FOREIGN KEY("UserId") REFERENCES "Users"("UserId") ON DELETE CASCADE ON UPDATE CASCADE,CONSTRAINT "ForeignSynchronizesItems" FOREIGN KEY("ItemId") REFERENCES "Items"("ItemId") ON DELETE CASCADE ON UPDATE CASCADE)
CREATE VIEW "Item" ("UserId","ItemId","Title","DateCreated","DateModified","ContentType","MediaType","IsFolder","IsLink","IsDocument","Size","Trashed","Loaded","CanAddChild","CanRename","IsReadOnly","IsVersionable","SyncMode","IsRoot","RootId") AS SELECT "U"."UserId","I"."ItemId","I"."Title","I"."DateCreated","I"."DateModified",CASE WHEN "I"."MediaType" IN ("S"."Set2","S"."Set3") THEN "I"."MediaType" ELSE "S"."Set1" END,"I"."MediaType","I"."MediaType"="S"."Set2","I"."MediaType"="S"."Set3","I"."MediaType"!="S"."Set2" AND "I"."MediaType"!="S"."Set3","I"."Size","I"."Trashed","I"."Loaded","C"."CanAddChild","C"."CanRename","C"."IsReadOnly","C"."IsVersionable","C"."SyncMode","I"."ItemId"="U"."RootId","U"."RootId" FROM "Settings" AS "S","Items" AS "I" JOIN "Capabilities" AS "C" ON "I"."ItemId"="C"."ItemId" JOIN "Users" AS "U" ON "C"."UserId"="U"."UserId" WHERE "S"."Setting"='ContentType'
CREATE VIEW "Child" ("UserId","ItemId","ParentId","Title","DateCreated","DateModified","MediaType","IsFolder","Size","Trashed","Loaded","CanAddChild","CanRename","IsReadOnly","IsVersionable","SyncMode","IsRoot","AtRoot") AS SELECT "I"."UserId","I"."ItemId","P"."ItemId","I"."Title","I"."DateCreated","I"."DateModified","I"."MediaType","I"."IsFolder","I"."Size","I"."Trashed","I"."Loaded","I"."CanAddChild","I"."CanRename","I"."IsReadOnly","I"."IsVersionable","I"."SyncMode", "I"."IsRoot","P"."ItemId"="I"."RootId" FROM "Item" AS "I" JOIN "Parents" AS "P" ON "I"."ItemId"="P"."ChildId" AND "I"."UserId"="P"."UserId"
CREATE USER SA PASSWORD ""
GRANT DBA TO SA
SET WRITE_DELAY 60
